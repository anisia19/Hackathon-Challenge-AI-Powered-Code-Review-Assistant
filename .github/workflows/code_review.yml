name: Local AI Code Review Test

# Rulează pe evenimentul pull_request deschis, sincronizat sau re-deschis
on:
  pull_request:
    types: [opened, synchronize, reopened]

jobs:
  ai_review_test:
    runs-on: ubuntu-latest

    # Configurăm serviciul Ollama ca un container sidecar
    services:
      ollama:
        image: ollama/ollama
        ports:
          - 11434:11434
        # Așteptăm ca Ollama să pornească
        options: >-
          --health-cmd "ollama --version" 
          --health-interval 10s 
          --health-timeout 5s 
          --health-retries 10

    steps:
      - name: Wait for Ollama Service
        # Adăugăm un pas simplu pentru a aștepta serviciul Ollama, asigurând că pornește.
        run: echo "Ollama service is starting..." && sleep 15s

      - name: Run AI Code Review Action
        # Aceasta este cheia: apelăm acțiunea definită local în acest depozit.
        # Sintaxa './' înseamnă "folosește fișierul action.yml din rădăcina acestui repo".
        uses: ./
        with:
          # TOKEN-ul este furnizat automat de GitHub
          github-token: ${{ secrets.GITHUB_TOKEN }}

          # URL-ul se adresează containerului sidecar Ollama
          ollama-api-url: "http://ollama:11434"

          # pr-number este preluat automat
